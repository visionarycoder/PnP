name: Update Changelog

on:
  release:
    types: [published]

jobs:
  update-changelog:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: main

      - name: Install git-chglog
        run: |
          CHGLOG_VERSION="0.9.1"
          curl -L -o git-chglog "https://github.com/git-chglog/git-chglog/releases/download/${CHGLOG_VERSION}/git-chglog_linux_amd64"
          chmod +x git-chglog

      - name: Generate CHANGELOG.md
        run: |
          ./git-chglog -o CHANGELOG.md

      - name: Commit & PR
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: update CHANGELOG.md"
          title: "üìù Update Changelog"
          body: "This PR updates the changelog for the new release."
